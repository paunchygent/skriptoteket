<!doctype html>
<html lang="sv">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title or "Skriptoteket" }}</title>
    {% block head_extra %}{% endblock %}
    <!-- Google Fonts: IBM Plex family -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Serif:wght@400;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- HuleEdu design system -->
    <link rel="stylesheet" href="/static/css/app.css">
  </head>
  <body class="huleedu-base" hx-boost="true">
    <div class="huleedu-frame">
      <header class="huleedu-header">
        <div class="huleedu-flex-center">
          <a href="/" class="huleedu-header-brand">Skriptoteket</a>
          {% if user %}
            <span class="huleedu-header-separator"></span>
            <nav class="huleedu-header-nav">
              <a href="/browse">Katalog</a>
              {% if user.role != "user" %}
                <a href="/my-tools">Mina verktyg</a>
                <a href="/suggestions/new">Föreslå skript</a>
              {% endif %}
              {% if user.role in ["admin", "superuser"] %}
                <a href="/admin/suggestions">Förslag</a>
                <a href="/admin/tools">Verktyg</a>
              {% endif %}
            </nav>
          {% endif %}
        </div>
        {% if user %}
        <form method="post" action="/logout">
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
          <button type="submit" class="huleedu-btn huleedu-btn-secondary huleedu-btn-sm">Logga ut</button>
        </form>
        {% endif %}
      </header>
      <main class="{% block main_class %}huleedu-main{% endblock %}">
        {% block content %}{% endblock %}
      </main>
    </div>
    <div id="toast-container" class="huleedu-toast-container"></div>
    <script src="/static/vendor/htmx.min.js" defer></script>
    <script src="/static/js/app.js" defer></script>
    <script>
      // Auto-dismiss toasts after delay
      document.body.addEventListener('htmx:afterSwap', function() {
        document.querySelectorAll('[data-auto-dismiss]').forEach(function(toast) {
          if (toast.dataset.dismissScheduled) return;
          toast.dataset.dismissScheduled = 'true';
          var delay = parseInt(toast.dataset.autoDismiss) || 5000;
          setTimeout(function() {
            toast.classList.add('huleedu-toast-dismiss-out');
            setTimeout(function() { toast.remove(); }, 300);
          }, delay);
        });
      });
    </script>
    {% block scripts_extra %}{% endblock %}
  </body>
</html>
